<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>WLang specification</title>
    <style type="text/css">
      body {
        font-family: arial, verdana, sans-serif;
        font-size: 14px;
        width: 1024px; 
        margin: auto; 
        margin-top: 20px;
      }
      p {margin: 0px;}
      h2 {
        border-bottom: 1px solid black;
      }
      h3 { margin-bottom: 5px; }
      h4 { margin-bottom: 3px; float: left; margin-top: 0px; }
      table {
        font-size: 12px;
        border-collapse: collapse; 
        border: 1px solid black;
      }
      table th { font-weight: normal; }

      table.ruleset th { background: green; color: white; }
      table.ruleset th, table.ruleset td { padding: 4px; }
      table.ruleset td { border-bottom: 1px dashed black; }
      th.signature, td.signature { width: 250px; }
      th.name, td.name { width: 150px; }
      th.definition, td.definition { width: 600px; }

      table.examples { float: right; }
      table.examples th { background: yellow; color: black; border-bottom: 1px solid black; }
      table.examples th, table.examples td { padding: 4px; }
      table.examples td { border-bottom: 1px dashed black; }
      th.dialect, td.dialect { width: 150px; }
      th.expression, td.expression { width: 350px; }
      th.replacement, td.replacement { width: 350px; }
    </style>
  </head>
  <body>
    <h1>WLang specification (version 0.0.7)</h1>
    <p>
WLang is a a reusable and extensible <em>code generator</em>, also known as
a <em>templating engine</em>
</p>

    <h2>Standard rulesets</h2>
    
      <h3>Basic</h3>
      <table class="ruleset">
        <tr>
          <th class="signature">signature</th>
          <th class="name">name</th>
          <th class="definition">definition</th>
        </tr>
        
          <tr>
            <td class="signature"><tt>!{wlang/hosted}</tt></td>
            <td class="name">execution</td>
            <td class="definition"><p>
Instanciates #1, looking for an expression of the hosting language.
Evaluates it, looking for any object. Converts it to a string (using to_s
for example if Ruby is the hosting language) and returns the result as
replacement value.
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>%{wlang/active-string}{...}</tt></td>
            <td class="name">modulation</td>
            <td class="definition"><p>
Instanciates #1, looking for a dialect qualified name. Instantiates #2
according to the rules defined by that dialect and returns the #2&#8217;s
instantiation as replacement value.
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>^{wlang/active-string}{...}</tt></td>
            <td class="name">encoding</td>
            <td class="definition"><p>
Instanciates #1, looking for an encoder qualified name. Instanciates #2 in
the current dialect. Encode #2&#8217;s instantiation using encoder found in
(#1)
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>${wlang/hosted}</tt></td>
            <td class="name">injection</td>
            <td class="definition"><p>
Same semantics as execution so far.
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>+{wlang/hosted}</tt></td>
            <td class="name">inclusion</td>
            <td class="definition"><p>
Same semantics as execution so far.
</p>
</td>
          </tr>
        
      </table>
      
      
        <br/>
        <h4>Examples:</h4>
        <table class="examples">
          <tr>
            <th>dialect</th>
            <th>wlang expression</th>
            <th>replacement value</th>
          </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/active-string</tt>
              </td>
              <td class="expression">
                <tt>Hello !{name}</tt>
              </td>
              <td class="replacement">
                <tt>Hello O'Neil</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/active-string</tt>
              </td>
              <td class="expression">
                <tt>Hello %{wlang/dummy}{!{name}}</tt>
              </td>
              <td class="replacement">
                <tt>Hello !{name}</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/dummy</tt>
              </td>
              <td class="expression">
                <tt>Hello %{wlang/dummy}{!{name}}</tt>
              </td>
              <td class="replacement">
                <tt>Hello %{wlang/dummy}{!{name}}</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/active-string</tt>
              </td>
              <td class="expression">
                <tt>Hello ^{plain-text/upcase}{!{name}}</tt>
              </td>
              <td class="replacement">
                <tt>Hello O'NEIL</tt>
              </td>
            </tr>
          
        </table>
        <div style="clear: both;"></div>
      
    
      <h3>Encoding</h3>
      <table class="ruleset">
        <tr>
          <th class="signature">signature</th>
          <th class="name">name</th>
          <th class="definition">definition</th>
        </tr>
        
          <tr>
            <td class="signature"><tt>&amp;{...}</tt></td>
            <td class="name">main-encoding</td>
            <td class="definition"><p>
<tt>^{+{@parser.current_dialect}/main-encoding}{#1}</tt>
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>&amp;;{...}</tt></td>
            <td class="name">entities-encoding</td>
            <td class="definition"><p>
<tt>^{+{@parser.current_dialect}/entities-encoding}{#1}</tt>
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>&amp;'{...}</tt></td>
            <td class="name">single-quoting</td>
            <td class="definition"><p>
<tt>^{+{@parser.current_dialect}/single-quoting}{#1}</tt>
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>&amp;&quot;{...}</tt></td>
            <td class="name">double-quoting</td>
            <td class="definition"><p>
<tt>^{+{@parser.current_dialect}/double-quoting}{#1}</tt>
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>${wlang/hosted}</tt></td>
            <td class="name">injection</td>
            <td class="definition"><p>
<tt>&amp;{+{#1}}</tt>
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>'{wlang/hosted}</tt></td>
            <td class="name">single-quoted</td>
            <td class="definition"><p>
<tt>'&amp;'{+{#1}}</tt> (first single quote is kept in the result)
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>&quot;{wlang/hosted}</tt></td>
            <td class="name">double-quoted</td>
            <td class="definition"><p>
<tt>&quot;&amp;&quot;{+{#1}}</tt> (first double quote is kept in the
result)
</p>
</td>
          </tr>
        
      </table>
      
      
        <br/>
        <h4>Examples:</h4>
        <table class="examples">
          <tr>
            <th>dialect</th>
            <th>wlang expression</th>
            <th>replacement value</th>
          </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/xhtml</tt>
              </td>
              <td class="expression">
                <tt>Hello &amp;{name}</tt>
              </td>
              <td class="replacement">
                <tt>Hello name</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/xhtml</tt>
              </td>
              <td class="expression">
                <tt>Hello &amp;{&lt;script&gt;}</tt>
              </td>
              <td class="replacement">
                <tt>Hello &amp;lt;script&amp;gt;</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/xhtml</tt>
              </td>
              <td class="expression">
                <tt>Hello &amp;;{&lt;script&gt;}</tt>
              </td>
              <td class="replacement">
                <tt>Hello &amp;lt;script&amp;gt;</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/ruby</tt>
              </td>
              <td class="expression">
                <tt>puts 'Hello &amp;'{name}'</tt>
              </td>
              <td class="replacement">
                <tt>puts 'Hello name'</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/ruby</tt>
              </td>
              <td class="expression">
                <tt>puts 'Hello &amp;'{!{name}}'</tt>
              </td>
              <td class="replacement">
                <tt>puts 'Hello O\'Neil'</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/ruby</tt>
              </td>
              <td class="expression">
                <tt>puts 'Hello ' &lt;&lt; '{name}'</tt>
              </td>
              <td class="replacement">
                <tt>puts 'Hello ' &lt;&lt; 'O\'Neil'</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/sql</tt>
              </td>
              <td class="expression">
                <tt>... WHERE name='{name}'</tt>
              </td>
              <td class="replacement">
                <tt>... WHERE name='O\'Neil'</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/sql/sybase</tt>
              </td>
              <td class="expression">
                <tt>... WHERE name='{name}'</tt>
              </td>
              <td class="replacement">
                <tt>... WHERE name='O''Neil'</tt>
              </td>
            </tr>
          
        </table>
        <div style="clear: both;"></div>
      
    
      <h3>Imperative</h3>
      <table class="ruleset">
        <tr>
          <th class="signature">signature</th>
          <th class="name">name</th>
          <th class="definition">definition</th>
        </tr>
        
          <tr>
            <td class="signature"><tt>?{wlang/hosted}{...}{...}</tt></td>
            <td class="name">conditional</td>
            <td class="definition"><p>
<b>(third block is optional)</b> Instanciates #1, looking for an expression
in the hosting language. Evaluates it, looking for a boolean value
(according to boolean semantics of the hosting language). If true,
instanciates #2, otherwise instanciates #3 if present.
</p>
</td>
          </tr>
        
          <tr>
            <td class="signature"><tt>*{wlang/hosted as x}{...}{...}</tt></td>
            <td class="name">enumeration</td>
            <td class="definition"><p>
<b>(third block is optional)</b> Instanciates #1, looking for an expression
in the hosting language. Evaluates it, looking for an enumerable. Iterates
all its elements, instanciating #2 for each of them (the iterated value is
set under name x in the scope). If #3 is present, it is instanciated
between elements.
</p>
</td>
          </tr>
        
      </table>
      
      
        <br/>
        <h4>Examples:</h4>
        <table class="examples">
          <tr>
            <th>dialect</th>
            <th>wlang expression</th>
            <th>replacement value</th>
          </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/*</tt>
              </td>
              <td class="expression">
                <tt>?{true}{then}{else}</tt>
              </td>
              <td class="replacement">
                <tt>then</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/*</tt>
              </td>
              <td class="expression">
                <tt>?{/th/ =~ &quot;not tat&quot;}{then}{else}</tt>
              </td>
              <td class="replacement">
                <tt>else</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/*</tt>
              </td>
              <td class="expression">
                <tt>?{authors.include? &quot;blambeau&quot;}{yes}{no}</tt>
              </td>
              <td class="replacement">
                <tt>yes</tt>
              </td>
            </tr>
          
            <tr>
              <td class="dialect">
                <tt>wlang/*</tt>
              </td>
              <td class="expression">
                <tt>[*{authors as a}{&quot;{a}&quot;}{, }]</tt>
              </td>
              <td class="replacement">
                <tt>[&quot;blambeau&quot;, &quot;llambeau&quot;, &quot;ancailliau&quot;]</tt>
              </td>
            </tr>
          
        </table>
        <div style="clear: both;"></div>
      
    
      <h3>Buffering</h3>
      <table class="ruleset">
        <tr>
          <th class="signature">signature</th>
          <th class="name">name</th>
          <th class="definition">definition</th>
        </tr>
        
          <tr>
            <td class="signature"><tt>&lt;&lt;{wlang/uri}</tt></td>
            <td class="name">input</td>
            <td class="definition"><p>
Instanciates #1, looking for an uri. Returns the text content of the found
uri (#1).
</p>
</td>
          </tr>
        
      </table>
      
      
    
  </body>
</html>
